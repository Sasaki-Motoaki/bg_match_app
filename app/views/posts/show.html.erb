<h1>イベント詳細ページ</h1>
<h3>イベント主催者: <%= link_to @post.user.name, user_path(@post.user.id) %></h3>
<h3>イベント詳細: <%= @post.description %></h3>
<%= image_tag @post.post_image.url if @post.post_image? %>
<h3 id="participants">参加人数: <%= @post.participates.count + 1 %>人</h3>
<div id="participate-button">
  <% if user_signed_in? && current_user.id != @post.user.id %>
    <% if current_user.already_participated?(@post) %>
      <%= button_to '参加を取り消す', post_participate_path(@post), method: :delete %>
    <% else %>
      <%= button_to '参加する', post_participates_path(@post), method: :post %>
    <% end %>
  <% end %>
</div>
<% if !@post.latitude.nil? || !@post.longitude.nil? %>
  <div id="map" style='width: 100%; height: 500px;'></div>
    <script type="text/javascript">
      handler = Gmaps.build('Google', { markers: { maxRandomDistance: 5 } });
        handler.buildMap({ provider: { scrollwheel: false }, internal: {id: 'map'}}, function(){
              markers = handler.addMarkers([
                  {
                    "lat": <%= @post.latitude %>,
                    "lng": <%= @post.longitude %>,
                    "infowindow": '<p><%= @post.name %></p><p><%= @post.address %></p><p><%= link_to "イベント詳細" ,post_path(@post.id),target: "_blank" %></p><p><%= link_to "Googleマップで見る" ,"https://maps.google.co.jp/maps?q=loc:#{@post.latitude},#{@post.longitude}&iwloc=J",target: "_blank" %></p>'
                  }
                ]);
            
          handler.bounds.extendWith(markers);
          handler.fitMapToBounds();
          handler.getMap().setZoom(15);
        });
    </script>
<% else %>
  <h3>位置情報はありません</h3>
<% end %>
<h2>参加するユーザー</h2>
<li><%= link_to @post.user.name, user_path(@post.user.id) %></li>
<% @post.participated_users.each do |user| %>
  <li><%= link_to user.name, user_path(user.id) %></li>
<% end %>
<% if user_signed_in? && current_user.id == @post.user.id %>
  <%= link_to "イベント編集", edit_post_path(@post)  %>  
  <%= link_to "イベント削除", post_path, method: :delete, data: { confirm: "本当に削除しますか？" } %>
<% end %>